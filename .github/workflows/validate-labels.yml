name: Validate PR Labels

on:
  pull_request:
    types: [opened, synchronize, labeled, unlabeled]
    branches: [main]
    
jobs:
  validate-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Check for release labels
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.pull_request.labels.map(label => label.name);
            const releaseLabels = ['patch', 'minor', 'skip-release'];
            const hasReleaseLabel = labels.some(label => releaseLabels.includes(label));
            
            if (!hasReleaseLabel) {
              core.setFailed('This PR needs one of these labels: ' + releaseLabels.join(', '));
              
              const commentBody = [
                '## Required Label',
                '',
                'This PR needs a release label:',
                '',
                '- `patch` - For bug fixes and minor changes',
                '- `minor` - For new features',
                '- `skip-release` - For changes that don\'t need a new version',
                '',
                'Please add one of these labels to merge the PR.'
              ].join('\n');
              
              await github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: commentBody
              });
            } else {
              const validLabels = labels.filter(label => releaseLabels.includes(label)).join(', ');
              console.log('PR has valid label: ' + validLabels);
            }
